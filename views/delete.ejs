<% layout("/layouts/boilerplate") %>

<style>
/* Modern Delete Page Styling */
.delete-container {
    max-width: 600px;
    margin: 0 auto;
}

.warning-icon {
    font-size: 4rem;
    color: #dc3545;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.danger-card {
    border: 2px solid #dc3545;
    border-radius: 16px;
    overflow: hidden;
    background: linear-gradient(to bottom, #fff5f5, #fff);
}

.danger-card-header {
    background: linear-gradient(135deg, #dc3545, #c82333);
    border-bottom: none;
}

.user-info-box {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 20px;
    border-left: 4px solid #dc3545;
}

.user-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #dc3545;
}

.password-input-group {
    border: 2px solid #dc3545;
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.password-input-group:focus-within {
    box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
    transform: translateY(-2px);
}

.confirm-checkbox {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

/* Responsive design */
@media (max-width: 768px) {
    .warning-icon {
        font-size: 3rem;
    }
    
    .delete-container {
        padding: 0 15px;
    }
}
</style>

<body>
    <div class="container py-5">
        <div class="delete-container">
            <!-- Warning Header -->
            <div class="text-center mb-5">
                <div class="warning-icon mb-3">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h1 class="display-6 fw-bold text-danger mb-3">Confirm Deletion</h1>
                <p class="text-muted lead">This action will permanently delete the user account</p>
            </div>

            <!-- Main Card -->
            <div class="danger-card shadow-lg">
                <!-- Card Header -->
                <div class="danger-card-header text-white py-4">
                    <div class="text-center">
                        <h3 class="fw-bold mb-2">
                            <i class="fas fa-trash-alt me-2"></i>Delete User
                        </h3>
                        <p class="mb-0 opacity-90">
                            ID: <span class="fw-bold"><%= users._id.toString().slice(-8) %></span>
                        </p>
                    </div>
                </div>

                <!-- Card Body -->
                <div class="card-body p-4 p-md-5">
                    <!-- User Information -->
                    <div class="user-info-box mb-4">
                        <div class="row align-items-center">
                            <div class="col-md-3 text-center mb-3 mb-md-0">
                                <img src="<%= users.image %>" 
                                     alt="<%= users.name %>" 
                                     class="user-avatar shadow-sm">
                            </div>
                            <div class="col-md-9">
                                <h4 class="fw-bold mb-2"><%= users.name %></h4>
                                <div class="d-flex flex-wrap gap-3">
                                    <span class="badge bg-light text-dark">
                                        <i class="fas fa-envelope me-1"></i>
                                        <%= users.email %>
                                    </span>
                                    <span class="badge bg-light text-dark">
                                        <i class="fas fa-users me-1"></i>
                                        <%= users.followers %> followers
                                    </span>
                                    <span class="badge bg-light text-dark">
                                        <i class="fas fa-heart me-1"></i>
                                        <%= users.likes %> likes
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Warning Message -->
                    <div class="alert alert-danger border-danger mb-4">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-radiation-alt fa-lg me-3 mt-1"></i>
                            <div>
                                <h5 class="alert-heading fw-bold">Warning: Permanent Action</h5>
                                <p class="mb-0">
                                    This will permanently delete the user account and all associated data. 
                                    This action cannot be undone.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Delete Form -->
                    <form method="post" action="/users/<%= users._id %>?_method=delete" 
                          class="needs-validation" novalidate id="deleteForm">
                        
                        <!-- Password Verification -->
                        <div class="mb-4">
                            <label for="password" class="form-label fw-medium mb-3">
                                <i class="fas fa-lock me-2"></i>
                                Enter password to confirm deletion
                            </label>
                            <div class="password-input-group">
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-0">
                                        <i class="fas fa-key text-danger"></i>
                                    </span>
                                    <input type="password" 
                                           name="password" 
                                           id="password" 
                                           class="form-control border-0" 
                                           placeholder="Enter your password" 
                                           required>
                                    <button class="btn btn-outline-secondary border-0" 
                                            type="button" 
                                            id="togglePassword">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="invalid-feedback">
                                Please enter your password to confirm
                            </div>
                        </div>

                        <!-- Confirmation Checkbox -->
                        <div class="form-check mb-4">
                            <input class="form-check-input confirm-checkbox" 
                                   type="checkbox" 
                                   id="confirmDelete" 
                                   required>
                            <label class="form-check-label fw-medium" for="confirmDelete">
                                I understand that this action is permanent and cannot be undone
                            </label>
                            <div class="invalid-feedback">
                                You must confirm before proceeding
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex flex-column flex-sm-row justify-content-between gap-3 pt-4 border-top">
                            <a href="/users/<%= users._id %>" 
                               class="btn btn-outline-secondary px-4 py-2 order-2 order-sm-1">
                                <i class="fas fa-arrow-left me-2"></i>
                                Cancel
                            </a>
                            
                            <button type="submit" 
                                    class="btn btn-danger px-5 py-2 order-1 order-sm-2"
                                    id="deleteBtn"
                                    disabled>
                                <i class="fas fa-trash-alt me-2"></i>
                                Delete Account
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Alternative Option -->
            <div class="text-center mt-4">
                <p class="text-muted small">
                    Want to make changes instead? 
                    <a href="/users/<%= users._id %>/edit" class="text-decoration-none">
                        Edit user account
                    </a>
                </p>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('deleteForm');
        const confirmCheckbox = document.getElementById('confirmDelete');
        const deleteBtn = document.getElementById('deleteBtn');
        const passwordInput = document.getElementById('password');
        const togglePasswordBtn = document.getElementById('togglePassword');
        
        // Enable/disable delete button based on checkbox and password
        function updateDeleteButton() {
            const isConfirmed = confirmCheckbox.checked;
            const hasPassword = passwordInput.value.trim().length > 0;
            deleteBtn.disabled = !(isConfirmed && hasPassword);
        }
        
        // Event listeners for checkbox and password
        confirmCheckbox.addEventListener('change', updateDeleteButton);
        passwordInput.addEventListener('input', updateDeleteButton);
        
        // Toggle password visibility
        if (togglePasswordBtn) {
            togglePasswordBtn.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });
        }
        
        // Form validation
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        });
        
        // Confirm before submitting
        form.addEventListener('submit', function(event) {
            if (form.checkValidity()) {
                const confirmed = confirm("⚠️ FINAL WARNING:\n\nAre you absolutely sure you want to delete this user account?\n\nThis action is PERMANENT and cannot be undone.");
                if (!confirmed) {
                    event.preventDefault();
                }
            }
        });
        
        // Initialize button state
        updateDeleteButton();
    });
    </script>
</body>
</html>